<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AQUARIUS AI - IMMERSIVE OS v9.9 (Energy Fallback)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet" />
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

    <!-- Tone.js for Sound Effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <style>
        :root {
            --retro-green: #33ff33;
            --dark-bg: #0a0a0a;
        }
        body {
            font-family: 'VT323', monospace;
            background-color: var(--dark-bg);
            color: var(--retro-green);
            text-shadow: 0 0 5px rgba(51, 255, 51, 0.5);
            overflow: hidden;
        }
        #starfield-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            background: linear-gradient(to bottom, rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            background-size: 100% 4px;
            animation: scan 0.1s linear infinite;
            z-index: 9999;
        }
        .crt-effect {
            box-shadow: 0 0 25px rgba(51, 255, 51, 0.3), inset 0 0 25px rgba(51, 255, 51, 0.2);
            border-radius: 20px;
            animation: flicker 0.15s infinite;
        }
        .retro-input, .retro-textarea {
            background-color: transparent; border: 1px solid var(--retro-green); border-radius: 0;
            color: var(--retro-green); padding: 8px; outline: none; resize: none;
        }
        .retro-input:focus, .retro-textarea:focus {
            background-color: rgba(51, 255, 51, 0.1); box-shadow: 0 0 8px var(--retro-green);
        }
        .retro-button {
            background-color: transparent; border: 1px solid var(--retro-green); color: var(--retro-green);
            padding: 10px 15px; border-radius: 0; transition: all 0.2s; cursor: pointer;
        }
        .retro-button:hover:not(:disabled) {
            background-color: var(--retro-green); color: var(--dark-bg); text-shadow: none;
        }
        .retro-button:disabled { opacity: 0.4; cursor: not-allowed; }
        .retro-container { background-color: rgba(0,0,0,0.8); border: 1px solid var(--retro-green); }
        .retro-header { border-bottom: 1px solid var(--retro-green); padding: 0.75rem; text-transform: uppercase; }
        .glitch-text { animation: glitch 1.5s linear infinite; }
        .typing-cursor {
            display: inline-block; width: 10px; height: 1.2em;
            background-color: var(--retro-green);
            animation: blink-caret 1s step-end infinite; vertical-align: bottom;
        }
        .blessing-glow {
             animation: glowing-blessing 2s ease-in-out infinite;
        }
        .yellow-alert-flash {
            animation: yellow-flash 1s 2;
        }
        .unread-indicator {
            animation: pulse-yellow 2s infinite;
        }
        .text-shadow-baccarat {
             text-shadow: 0 0 15px currentColor, 0 0 25px rgba(255, 255, 255, 0.3);
        }
        
        @keyframes scan { 0% { background-position: 0 0; } 100% { background-position: 0 4px; } }
        @keyframes glitch { 2%,64%{ transform: translate(2px,0) skew(0deg); } 4%,60%{ transform: translate(-2px,0) skew(0deg); } 62%{ transform: translate(0,0) skew(5deg); } }
        @keyframes blink-caret { from, to { background-color: transparent; } 50% { background-color: var(--retro-green); } }
        @keyframes flicker { 0% { opacity: 1; } 50% { opacity: 0.98; } 100% { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes glowing-blessing {
            0% { box-shadow: 0 0 5px var(--retro-green); }
            50% { box-shadow: 0 0 20px var(--retro-green), 0 0 25px var(--retro-green); }
            100% { box-shadow: 0 0 5px var(--retro-green); }
        }
        @keyframes yellow-flash {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 255, 0, 0); }
            50% { box-shadow: 0 0 40px 20px rgba(255, 255, 0, 0.6), inset 0 0 25px rgba(255, 255, 0, 0.5); }
        }
        @keyframes pulse-yellow {
            0% { color: #eab308; } /* yellow-400 */
            50% { color: #fef08a; } /* yellow-200 */
            100% { color: #eab308; } /* yellow-400 */
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <div class="scanlines"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- REAL FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyCHDzGbXmHNWKL2UtRm57vPRVxZb31dHto",
            authDomain: "long-bao-tool-ai.firebaseapp.com",
            projectId: "long-bao-tool-ai",
            storageBucket: "long-bao-tool-ai.appspot.com",
            messagingSenderId: "259613170671",
            appId: "1:259613170671:web:55291d0b0af4e69052b41a",
            measurementId: "G-7V7H3JWX7K"
        };
        const ADMIN_USERNAME = "admin";
        const DUMMY_DOMAIN = "@long-bao-tool-ai.web.app";

        // --- FIREBASE INIT ---
        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const auth = firebase.auth();
        const db = firebase.firestore();
        const rtdb = firebase.database();

        // --- GAME DATA & CONSTANTS ---
        const BACARAT_TABLES = ["BACARAT C04", "BACARAT C05", "BACARAT C06", "BACARAT C07", "BACARAT C01", "BACARAT C02", "BACARAT C03", "BACARAT C08", "BACARAT C09", "BACARAT C10", "BACARAT 1", "BACARAT 2", "BACARAT 3", "BACARAT 4", "BACARAT 5", "BACARAT 7", "BACARAT 8", "BACARAT 9", "BACARAT 10", "BACARAT C11", "BACARAT C12", "BACARAT C13", "BACARAT C15"];
        const COOLDOWN_DURATION = 24 * 60 * 60 * 1000;
        const DAILY_QUESTION_LIMIT = 2;

        // --- SOUND SERVICE ---
        const soundService = {
            isStarted: false, synth: null, noise: null, ambient: null,
            init() {
                if (this.isStarted || typeof Tone === 'undefined') return;
                this.synth = new Tone.Synth().toDestination();
                this.noise = new Tone.NoiseSynth({ volume: -20 }).toDestination();
                this.ambient = new Tone.Noise("brown").toDestination();
                this.ambient.volume.value = -40;
                this.isStarted = true;
            },
            startAmbient() { if(this.ambient && this.ambient.state !== 'started') this.ambient.start(); },
            stopAmbient() { if(this.ambient) this.ambient.stop(); },
            playClick() { this.synth?.triggerAttackRelease("C2", "8n"); },
            playSend() { this.synth?.triggerAttackRelease("G4", "8n"); },
            playReceive() { this.synth?.triggerAttackRelease("C5", "8n"); },
            playError() { this.noise?.triggerAttackRelease("2n"); },
            playTyping() { this.synth?.triggerAttackRelease("C3", "32n"); },
            playAlert() {
                 if (!this.isStarted) this.init();
                 const synth = new Tone.Synth({
                    oscillator: { type: 'square' },
                    envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.2 }
                }).toDestination();
                synth.triggerAttackRelease('G5', '8n', Tone.now());
                synth.triggerAttackRelease('G5', '8n', Tone.now() + 0.2);
            }
        };

        //================================================================================
        // COMPONENT: Starfield
        //================================================================================
        const Starfield = () => {
            const canvasRef = useRef(null);
            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let stars = [];
                const numStars = 300;
                let animationFrameId;

                const resizeCanvas = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    stars = [];
                    for (let i = 0; i < numStars; i++) {
                        stars.push({
                            x: Math.random() * canvas.width,
                            y: Math.random() * canvas.height,
                            size: Math.random() * 1.5,
                            speed: Math.random() * 0.5 + 0.1
                        });
                    }
                };

                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = 'rgba(51, 255, 51, 0.8)';
                    stars.forEach(star => {
                        star.y += star.speed;
                        if (star.y > canvas.height) {
                            star.y = 0;
                            star.x = Math.random() * canvas.width;
                        }
                        ctx.beginPath();
                        ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    animationFrameId = requestAnimationFrame(animate);
                };

                resizeCanvas();
                animate();
                window.addEventListener('resize', resizeCanvas);
                return () => {
                    window.removeEventListener('resize', resizeCanvas);
                    cancelAnimationFrame(animationFrameId);
                }
            }, []);
            return <canvas id="starfield-canvas" ref={canvasRef}></canvas>;
        };

        //================================================================================
        // COMPONENT: LoadingMessage
        //================================================================================
        const LoadingMessage = ({ text }) => {
            const [progress, setProgress] = useState(0);
            const [isComplete, setIsComplete] = useState(false);

            useEffect(() => {
                const timer = setInterval(() => {
                    setProgress(prev => {
                        if (prev >= 100) {
                            clearInterval(timer);
                            setIsComplete(true);
                            return 100;
                        }
                        return prev + 1;
                    });
                }, 30);
                return () => clearInterval(timer);
            }, []);

            if (isComplete) {
                return <p style={{animation: 'fadeIn 0.5s forwards'}}>{text}</p>;
            }

            return (
                <div className="w-full">
                    <p className="text-center text-sm mb-1">ĐANG XỬ LÝ LỆNH... {progress}%</p>
                    <div className="w-full bg-gray-800 border border-green-700 h-4">
                        <div className="bg-green-500 h-full" style={{ width: `${progress}%`, transition: 'width 0.1s linear' }}></div>
                    </div>
                </div>
            );
        };

        //================================================================================
        // COMPONENT: MessageContent
        //================================================================================
        const MessageContent = ({ msg }) => {
            const content = (
                <>
                    {msg.type === 'system' && <p className="text-yellow-300 w-full text-center">{msg.text}</p>}
                    {msg.type === 'plea' && <p className="opacity-80 italic">Lời thỉnh cầu: "{msg.text}"</p>}
                    {msg.type === 'table_announcement' && (
                        <div className="text-center my-2 p-3 border-2 border-yellow-400 bg-yellow-900 bg-opacity-50">
                            <p className="text-yellow-300 text-lg glitch-text uppercase">!!! CHÚ Ý BÀN !!!</p>
                            <p className="text-white text-2xl font-bold">{msg.text}</p>
                        </div>
                    )}
                    {msg.type === 'baccarat_result' && (() => {
                        const colorClass = {
                            'blue-400': 'text-blue-400',
                            'red-500': 'text-red-500',
                            'green-400': 'text-green-400'
                        }[msg.content.color] || 'text-white';
                        return (
                            <div className="text-center my-2 p-4">
                                <p className={`text-9xl font-bold text-shadow-baccarat ${colorClass}`}>
                                    {msg.content.result}
                                </p>
                            </div>
                        );
                    })()}
                    {msg.type === 'blessing' && (
                        <div className="border-2 border-green-400 p-4 mt-1 blessing-glow text-center">
                            <p className="text-2xl glitch-text text-green-300 uppercase">Lời Ban Phước</p>
                            <div className="mt-4 text-left space-y-2">
                                <p className="text-lg"><span className="font-bold text-green-400 w-24 inline-block">SỐ BÀN:</span> <span className="text-white text-xl font-bold">{msg.content.table}</span></p>
                                <p className="text-lg"><span className="font-bold text-green-400 w-24 inline-block">KẾT QUẢ:</span> <span className="text-white text-xl font-bold">{msg.content.side}</span></p>
                                <p className="text-lg"><span className="font-bold text-green-400 w-24 inline-block">TAY THỨ:</span> <span className="text-white text-xl font-bold">{msg.content.hand}</span></p>
                            </div>
                        </div>
                    )}
                    {msg.type === 'info_submission' && (
                        <div className="border border-cyan-700 p-2 mt-1">
                            <p className="glitch-text text-center text-lg text-cyan-400">BÁO CÁO KHỞI TẠO</p>
                            <p>> TÀI KHOẢN F168: {msg.content.f168Account}</p>
                            <p>> SỐ VỐN: {msg.content.capital}</p>
                            <p>> MỤC TIÊU: {msg.content.target}</p>
                        </div>
                    )}
                    {msg.type === 'text' && <p>{msg.text}</p>}
                    {msg.type === 'loading_message' && <LoadingMessage text={msg.text} />}
                </>
            );

            return (
                <div>
                    {content}
                    {msg.edited && <span className="text-xs opacity-60 italic ml-2">(đã sửa)</span>}
                </div>
            );
        };
        
        //================================================================================
        // COMPONENT: LoginScreen
        //================================================================================
        const LoginScreen = () => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [booting, setBooting] = useState(true);
            const [bootLines, setBootLines] = useState([]);

            useEffect(() => {
                const bootSequence = [
                    'AQUARIUS OS v9.9 INITIALIZING...',
                    'CHECKING MEMORY... OK',
                    'LOADING CORE MODULES... OK',
                    'ESTABLISHING FIREBASE CONNECTION... SECURE',
                    'AWAITING PILOT AUTHENTICATION...'
                ];
                let index = 0;
                const interval = setInterval(() => {
                    soundService.playTyping();
                    setBootLines(prev => [...prev, bootSequence[index]]);
                    index++;
                    if (index >= bootSequence.length) {
                        clearInterval(interval);
                        setTimeout(() => setBooting(false), 500);
                    }
                }, 600);
                return () => clearInterval(interval);
            }, []);

            const handleLogin = async () => {
                setError(''); setIsLoading(true);
                const processedUsername = username.trim().toLowerCase();
                if (!processedUsername || !password) { setError("LỖI: THIẾU TÍN HIỆU"); setIsLoading(false); return; }
                const email = processedUsername + DUMMY_DOMAIN;
                try { await auth.signInWithEmailAndPassword(email, password); } 
                catch (err) { setError("LỖI: XÁC THỰC THẤT BẠI"); } 
                finally { setIsLoading(false); }
            };
            
            const handleSignup = async () => {
                setError(''); setIsLoading(true);
                const processedUsername = username.trim().toLowerCase();
                if (!processedUsername || !password) { setError("LỖI: THIẾU TÍN HIỆU"); setIsLoading(false); return; }
                if (password.length < 6) { setError("LỖI: MẬT KHẨU QUÁ NGẮN (TỐI THIỂU 6 KÝ TỰ)"); setIsLoading(false); return; }
                
                try {
                    const usersRef = db.collection("users");
                    const existingUserQuery = await usersRef.where("username", "==", processedUsername).get();
                    if (!existingUserQuery.empty) {
                        setError("LỖI: MÃ HIỆU PILOT ĐÃ TỒN TẠI");
                        setIsLoading(false);
                        return;
                    }

                    const email = processedUsername + DUMMY_DOMAIN;
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    await db.collection("users").doc(userCredential.user.uid).set({
                        uid: userCredential.user.uid,
                        username: processedUsername,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        energy: 7,
                        hasSubmittedInfo: false,
                        dailyQuestionCount: 0,
                        lastQuestionTimestamp: null,
                        lastBlessingTimestamp: null
                    }, { merge: true });
                } catch (err) {
                    if (err.code === 'auth/email-already-in-use') { setError("LỖI: MÃ HIỆU PILOT ĐÃ TỒN TẠI"); } 
                    else { setError("LỖI: KHỞI TẠO PILOT THẤT BẠI"); }
                } finally { setIsLoading(false); }
            };

            if (booting) {
                return (
                    <div className="min-h-screen bg-black flex items-center justify-center">
                        <div className="w-full max-w-2xl p-4">
                            {bootLines.map((line, i) => <p key={i} className="text-lg">> {line}</p>)}
                            <span className="typing-cursor"></span>
                        </div>
                    </div>
                );
            }

            return (
                 <div className="min-h-screen flex flex-col items-center justify-center p-4" style={{animation: 'fadeIn 1s forwards'}}>
                    <div className="w-full max-w-md p-4 sm:p-8 space-y-4 retro-container">
                        <h2 className="text-3xl sm:text-4xl text-center glitch-text">AQUARIUS OS</h2>
                        <p className="text-center text-md sm:text-lg">> YÊU CẦU XÁC THỰC PILOT</p>
                        <div className="space-y-4">
                            <div>
                                <label className="text-md sm:text-lg">> MÃ HIỆU PILOT:</label>
                                <input value={username} onChange={e => setUsername(e.target.value)} type="text" required className="w-full mt-1 retro-input" />
                            </div>
                            <div>
                                <label className="text-md sm:text-lg">> MẬT KHẨU:</label>
                                <input value={password} onChange={e => setPassword(e.target.value)} type="password" required className="w-full mt-1 retro-input" />
                            </div>
                            {error && <div className="text-md sm:text-lg text-center py-2 bg-red-900 bg-opacity-50 border border-red-500">{error}<span className="typing-cursor"></span></div>}
                            <div className="flex items-center space-x-4">
                                <button onClick={handleLogin} disabled={isLoading} className="w-full retro-button">{isLoading ? 'ĐANG KẾT NỐI...' : 'KẾT NỐI'}</button>
                                <button onClick={handleSignup} disabled={isLoading} className="w-full retro-button">KHỞI TẠO</button>
                            </div>
                        </div>
                        <div className="text-center pt-4 border-t border-green-900">
                            <a href="https://t.me/longbaoF168" target="_blank" rel="noopener noreferrer" className="retro-button">LIÊN HỆ LONG BẢO</a>
                        </div>
                    </div>
                </div>
            );
        };
        
        //================================================================================
        // COMPONENT: AdminDashboard
        //================================================================================
        const AdminDashboard = ({ currentUser, onLogout }) => {
            const [conversations, setConversations] = useState([]);
            const [currentChat, setCurrentChat] = useState(null);
            const [messages, setMessages] = useState([]);
            const [inputMessage, setInputMessage] = useState('');
            const [onlineCount, setOnlineCount] = useState(0);
            const [tableAnnounceInput, setTableAnnounceInput] = useState('');
            const [editingMessage, setEditingMessage] = useState(null);
            const messagesListRef = useRef(null);
            const unsubscribeMessages = useRef(null);

            useEffect(() => {
                const convRef = db.collection('user_chats').orderBy('lastUpdate', 'desc');
                const unsubConv = convRef.onSnapshot(snapshot => {
                    setConversations(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                }, console.error);
                
                const statusRef = rtdb.ref('status');
                const unsubStatus = statusRef.on('value', snapshot => {
                    if (snapshot && typeof snapshot.val === 'function') {
                        const statuses = snapshot.val() || {};
                        const count = Object.values(statuses).filter(s => s.isOnline).length;
                        setOnlineCount(count);
                    }
                });

                return () => {
                    unsubConv();
                    unsubStatus();
                    if (unsubscribeMessages.current) {
                        unsubscribeMessages.current();
                    }
                };
            }, []);
            
            useEffect(() => {
                if (messagesListRef.current) {
                    messagesListRef.current.scrollTop = messagesListRef.current.scrollHeight;
                }
            }, [messages]);

            const loadConversation = (conv) => {
                setCurrentChat(conv);
                setEditingMessage(null);
                if (conv.isRead === false) {
                    db.collection('user_chats').doc(conv.id).update({ isRead: true }).catch(console.error);
                }
                
                if (unsubscribeMessages.current) {
                    unsubscribeMessages.current();
                }
                const messagesRef = db.collection('user_chats').doc(conv.id).collection('messages').orderBy('timestamp');
                unsubscribeMessages.current = messagesRef.onSnapshot(snapshot => {
                    setMessages(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                }, console.error);
            };
            
            const handleSendBaccaratResult = async (resultType) => {
                if (!currentChat) return;

                let content;
                switch(resultType) {
                    case 'P': content = { result: 'P', color: 'blue-400' }; break;
                    case 'B': content = { result: 'B', color: 'red-500' }; break;
                    case 'H': content = { result: 'H', color: 'green-400' }; break;
                    default: return;
                }

                soundService.playSend();
                await db.collection(`user_chats/${currentChat.id}/messages`).add({
                    type: 'baccarat_result',
                    content: content,
                    senderId: currentUser.uid,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                await db.collection('user_chats').doc(currentChat.id).update({
                    lastUpdate: firebase.firestore.FieldValue.serverTimestamp(),
                    isRead: true
                });
            };

            const handleSendMessage = async () => {
                const trimmedMessage = inputMessage.trim();
                if (trimmedMessage === '' || !currentChat) return;

                let messageData;
                if (trimmedMessage.startsWith('/load ')) {
                    const text = trimmedMessage.substring(6);
                    messageData = { type: 'loading_message', text: text };
                } else {
                    messageData = { type: 'text', text: trimmedMessage };
                }
                
                await db.collection(`user_chats/${currentChat.id}/messages`).add({
                    ...messageData,
                    senderId: currentUser.uid,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                await db.collection('user_chats').doc(currentChat.id).update({
                    lastUpdate: firebase.firestore.FieldValue.serverTimestamp()
                });
                setInputMessage('');
                soundService.playSend();
            };

            const handleSendTableMessage = async () => {
                if (tableAnnounceInput.trim() === '' || !currentChat) return;
                soundService.playAlert();
                await db.collection(`user_chats/${currentChat.id}/messages`).add({
                    type: 'table_announcement',
                    text: tableAnnounceInput.trim(),
                    senderId: currentUser.uid,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                });
                 await db.collection('user_chats').doc(currentChat.id).update({
                    lastUpdate: firebase.firestore.FieldValue.serverTimestamp()
                });
                setTableAnnounceInput('');
            };

            const handleDeleteMessage = async (messageId) => {
                if (!currentChat) return;
                try {
                    await db.collection(`user_chats/${currentChat.id}/messages`).doc(messageId).delete();
                    soundService.playClick();
                } catch (error) {
                    console.error("Error deleting message:", error);
                    soundService.playError();
                    alert("Lỗi: Không thể xóa tin nhắn.");
                }
            };

            const handleUpdateMessage = async () => {
                if (!editingMessage || !currentChat) return;
                const newText = editingMessage.text.trim();
                if (newText === '') {
                    handleDeleteMessage(editingMessage.id);
                    setEditingMessage(null);
                    return;
                }

                try {
                    await db.collection(`user_chats/${currentChat.id}/messages`).doc(editingMessage.id).update({
                        text: newText,
                        edited: true
                    });
                    setEditingMessage(null);
                    soundService.playSend();
                } catch (error) {
                    console.error("Error updating message:", error);
                    soundService.playError();
                    alert("Lỗi: Không thể cập nhật tin nhắn.");
                }
            };
            
            const AsciiChart = ({ value, total }) => {
                const percentage = total > 0 ? (value / total) * 100 : 0;
                const filledChars = Math.round((percentage / 100) * 20);
                const emptyChars = 20 - filledChars;
                const bar = `[${'█'.repeat(filledChars)}${'░'.repeat(emptyChars)}]`;
                return <pre className="text-sm">{bar} {value}/{total} ONLINE</pre>;
            };

            return (
                <div className="flex w-full h-screen p-1 sm:p-2 md:p-4">
                    <aside className={`w-full md:w-1/3 lg:w-1/4 retro-container flex-col ${currentChat ? 'hidden md:flex' : 'flex'}`}>
                        <header className="retro-header flex justify-between items-center flex-shrink-0">
                            <h2 className="text-lg sm:text-xl glitch-text">ĐIỀU KHIỂN</h2>
                            <button onClick={onLogout} className="text-xs retro-button">ĐĂNG XUẤT</button>
                        </header>
                         <div className="p-2 border-b border-green-900">
                            <p className="text-md sm:text-lg">TRẠNG THÁI</p>
                            <AsciiChart value={onlineCount} total={conversations.length} />
                        </div>
                        <div className="flex-1 overflow-y-auto">
                            {conversations.map(conv => (
                                <div 
                                    key={conv.id} 
                                    onClick={() => loadConversation(conv)} 
                                    className={`p-3 border-b border-green-900 cursor-pointer hover:bg-green-900 bg-opacity-50 flex justify-between items-center ${currentChat?.id === conv.id ? 'bg-green-800' : ''} ${conv.isRead === false ? 'bg-yellow-500 bg-opacity-20' : ''}`}
                                >
                                    <p className="font-semibold text-md sm:text-lg truncate">> {conv.username || 'Unknown'}</p>
                                    {conv.isRead === false && <span className="text-xs font-bold unread-indicator">[MỚI]</span>}
                                </div>
                            ))}
                        </div>
                    </aside>
                    <section className={`w-full md:w-2/3 lg:w-3/4 flex-col retro-container ml-0 md:ml-2 ${currentChat ? 'flex' : 'hidden md:flex'}`}>
                        {currentChat ? (
                            <React.Fragment>
                                <header className="retro-header flex items-center">
                                    <button onClick={() => setCurrentChat(null)} className="md:hidden mr-4 retro-button text-sm p-2">&lt;</button>
                                    > KÊNH: {currentChat.username}
                                </header>
                                <main ref={messagesListRef} className="flex-1 p-2 sm:p-4 overflow-y-auto">
                                    {messages.map(msg => {
                                        const isUserMessage = msg.senderId !== currentUser.uid;
                                        const isEditingThisMessage = editingMessage?.id === msg.id;
                                        const canBeEdited = msg.type === 'text' || msg.type === 'plea';

                                        return (
                                            <div key={msg.id} className={`group flex mb-4 items-end ${isUserMessage ? 'justify-start' : 'justify-end flex-row-reverse'}`}>
                                                <div className={`max-w-lg p-2 ${isUserMessage ? '' : 'text-cyan-300'}`}>
                                                    {isEditingThisMessage ? (
                                                        <div>
                                                            <textarea
                                                                value={editingMessage.text}
                                                                onChange={(e) => setEditingMessage({ ...editingMessage, text: e.target.value })}
                                                                onKeyDown={(e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleUpdateMessage(); } }}
                                                                className="w-full retro-textarea bg-gray-900"
                                                                rows="3"
                                                                autoFocus
                                                            />
                                                            <div className="text-right mt-1 space-x-2">
                                                                <button onClick={() => setEditingMessage(null)} className="retro-button text-xs p-1">Hủy</button>
                                                                <button onClick={handleUpdateMessage} className="retro-button text-xs p-1">Lưu</button>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <MessageContent msg={msg} />
                                                    )}
                                                </div>

                                                {!isEditingThisMessage && canBeEdited && (
                                                    <div className={`flex flex-col space-y-2 p-1 opacity-0 group-hover:opacity-100 transition-opacity ${isUserMessage ? '' : 'mr-2'}`}>
                                                        <button title="Sửa tin nhắn" onClick={() => setEditingMessage({ id: msg.id, text: msg.text })}>
                                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 text-yellow-400 hover:text-yellow-200" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z" /></svg>
                                                        </button>
                                                        <button title="Xóa tin nhắn" onClick={() => handleDeleteMessage(msg.id)}>
                                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 text-red-500 hover:text-red-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                                        </button>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </main>
                                <footer className="p-2 sm:p-4 border-t border-green-900">
                                    <div className="flex items-center border border-yellow-500 p-2 mb-2">
                                        <input value={tableAnnounceInput} onChange={e => setTableAnnounceInput(e.target.value)} className="flex-1 retro-input text-sm" placeholder="> GỬI BÀN..." />
                                        <button onClick={handleSendTableMessage} className="ml-2 retro-button border-yellow-500 text-yellow-400 hover:bg-yellow-500 hover:text-black text-sm">GỬI BÀN</button>
                                    </div>
                                    <div className="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-2">
                                        <button onClick={() => handleSendBaccaratResult('P')} className="retro-button text-sm border-blue-400 text-blue-400 hover:bg-blue-400 hover:text-black">NHÀ CON (P)</button>
                                        <button onClick={() => handleSendBaccaratResult('B')} className="retro-button text-sm border-red-500 text-red-500 hover:bg-red-500 hover:text-black">NHÀ CÁI (B)</button>
                                        <button onClick={() => handleSendBaccaratResult('H')} className="retro-button text-sm border-green-400 text-green-400 hover:bg-green-400 hover:text-black">HOÀ (H)</button>
                                        <button onClick={() => {setInputMessage('XIN VUI LÒNG ĐỢI'); handleSendMessage();}} className="retro-button text-sm">XIN VUI LÒNG ĐỢI</button>
                                    </div>
                                    <div className="flex items-center">
                                        <input value={inputMessage} onChange={e => setInputMessage(e.target.value)} onKeyPress={e => e.key === 'Enter' && handleSendMessage()} className="flex-1 retro-input" placeholder="> Phản hồi hoặc dùng lệnh /load..." />
                                        <button onClick={handleSendMessage} className="ml-2 retro-button">GỬI</button>
                                    </div>
                                </footer>
                            </React.Fragment>
                        ) : (
                            <div className="flex-1 flex items-center justify-center opacity-50 text-xl">> CHỌN KÊNH LIÊN LẠC</div>
                        )}
                    </section>
                </div>
            );
        };

        //================================================================================
        // COMPONENT: UserView
        //================================================================================
        const UserView = ({ currentUser, onLogout }) => {
            const [messages, setMessages] = useState([]);
            const [inputMessage, setInputMessage] = useState('');
            const [energy, setEnergy] = useState(7);
            const [showBlessingModal, setShowBlessingModal] = useState(false);
            const [plea, setPlea] = useState('');
            const [showInfoModal, setShowInfoModal] = useState(false);
            const [infoFormData, setInfoFormData] = useState({ f168Account: '', capital: '', target: '' });
            const [isAnnouncing, setIsAnnouncing] = useState(false);
            const messagesListRef = useRef(null);

            const [dailyQuestionsLeft, setDailyQuestionsLeft] = useState(DAILY_QUESTION_LIMIT);
            const [blessingCooldown, setBlessingCooldown] = useState(0);
            const QUESTION_ENERGY_COST = 7;

            const formatTime = (ms) => {
                if (ms <= 0) return "00:00:00";
                const totalSeconds = Math.floor(ms / 1000);
                const hours = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
                const minutes = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
                const seconds = (totalSeconds % 60).toString().padStart(2, '0');
                return `${hours}:${minutes}:${seconds}`;
            };

            useEffect(() => {
                if (!currentUser) return;
                
                const userDocRef = db.collection('users').doc(currentUser.uid);
                const unsubUser = userDocRef.onSnapshot(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        setEnergy(data.energy !== undefined ? data.energy : 7);
                        if (data.hasSubmittedInfo !== true) {
                            setShowInfoModal(true);
                        }

                        const now = Date.now();

                        // Check and set question limit
                        const lastQuestionTs = data.lastQuestionTimestamp?.toMillis() || 0;
                        if (now - lastQuestionTs > COOLDOWN_DURATION) {
                            setDailyQuestionsLeft(DAILY_QUESTION_LIMIT);
                        } else {
                            const questionsUsed = data.dailyQuestionCount || 0;
                            const questionsLeft = DAILY_QUESTION_LIMIT - questionsUsed;
                            setDailyQuestionsLeft(questionsLeft > 0 ? questionsLeft : 0);
                        }

                        // Check and set blessing limit
                        const lastBlessingTs = data.lastBlessingTimestamp?.toMillis() || 0;
                        if (now - lastBlessingTs > COOLDOWN_DURATION) {
                            setBlessingCooldown(0);
                        } else {
                            setBlessingCooldown((lastBlessingTs + COOLDOWN_DURATION) - now);
                        }
                    }
                });

                const messagesRef = db.collection('user_chats').doc(currentUser.uid).collection('messages').orderBy('timestamp');
                const unsubMessages = messagesRef.onSnapshot(snapshot => {
                    setMessages(prevMessages => {
                        const newMessages = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        if (newMessages.length > prevMessages.length) {
                            const latestMsg = newMessages[newMessages.length - 1];
                            if (latestMsg.senderId !== currentUser.uid) {
                                if (latestMsg.type === 'table_announcement' || latestMsg.type === 'baccarat_result' || latestMsg.type === 'loading_message') {
                                    soundService.playAlert();
                                    if(latestMsg.type === 'table_announcement') {
                                      setIsAnnouncing(true);
                                      setTimeout(() => setIsAnnouncing(false), 2000);
                                    }
                                } else {
                                    soundService.playReceive();
                                }
                            }
                        }
                        return newMessages;
                    });
                }, console.error);
                
                return () => { unsubUser(); unsubMessages(); };
            }, [currentUser]);

            useEffect(() => {
                const timer = setInterval(() => {
                    setBlessingCooldown(prev => prev > 0 ? prev - 1000 : 0);
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                 if (messagesListRef.current) messagesListRef.current.scrollTop = messagesListRef.current.scrollHeight;
            }, [messages]);
            
            const handleAskQuestion = async () => {
                const content = inputMessage.trim();
                if (content === '') return;

                const userDocRef = db.collection('users').doc(currentUser.uid);
                const chatDocRef = db.collection('user_chats').doc(currentUser.uid);
                const messagesPath = `user_chats/${currentUser.uid}/messages`;

                try {
                    await db.runTransaction(async (transaction) => {
                        const userDoc = await transaction.get(userDocRef);
                        if (!userDoc.exists) throw "Tài khoản không tồn tại!";
                        
                        const data = userDoc.data();
                        const now = Date.now();
                        const lastQuestionTs = data.lastQuestionTimestamp?.toMillis() || 0;
                        
                        let currentCount = data.dailyQuestionCount || 0;
                        let currentEnergy = data.energy || 0;

                        if (now - lastQuestionTs > COOLDOWN_DURATION) {
                            currentCount = 0;
                        }

                        const isFree = currentCount < DAILY_QUESTION_LIMIT;

                        if (isFree) {
                            transaction.update(userDocRef, {
                                dailyQuestionCount: currentCount + 1,
                                lastQuestionTimestamp: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        } else {
                            if (currentEnergy < QUESTION_ENERGY_COST) {
                                throw "Đã hết lượt hỏi miễn phí và không đủ năng lượng.";
                            }
                            transaction.update(userDocRef, { 
                                energy: firebase.firestore.FieldValue.increment(-QUESTION_ENERGY_COST) 
                            });
                        }
                        
                        const messageData = { type: 'text', text: content, senderId: currentUser.uid, timestamp: firebase.firestore.FieldValue.serverTimestamp() };
                        const newMessageRef = db.collection(messagesPath).doc();
                        transaction.set(newMessageRef, messageData);
                        
                        const username = currentUser.email.split('@')[0];
                        transaction.set(chatDocRef, {
                            lastUpdate: firebase.firestore.FieldValue.serverTimestamp(),
                            username: username,
                            userId: currentUser.uid,
                            isRead: false 
                        }, { merge: true });
                    });
                    soundService.playSend();
                    setInputMessage('');
                } catch (error) {
                    console.error("Transaction failed: ", error);
                    alert(typeof error === 'string' ? error : "Lỗi: Không thể gửi tin nhắn.");
                    soundService.playError();
                }
            };
            
            const handleBlessingRequest = async () => {
                if (plea.trim() === '') return;
                if (blessingCooldown > 0) {
                    alert("Bạn đã nhận ban phước rồi. Vui lòng quay lại sau.");
                    return;
                }
                
                setShowBlessingModal(false);
                
                await db.collection(`user_chats/${currentUser.uid}/messages`).add({
                    type: 'plea',
                    text: plea.trim(),
                    senderId: currentUser.uid,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                const blessing = {
                    table: BACARAT_TABLES[Math.floor(Math.random() * BACARAT_TABLES.length)],
                    side: Math.random() < 0.5 ? 'NHÀ CON' : 'NHÀ CÁI',
                    hand: Math.floor(Math.random() * (30 - 15 + 1)) + 15
                };
                
                setTimeout(async () => {
                    const blessingMessage = {
                        type: 'blessing',
                        content: blessing,
                        senderId: 'AQUARIUS_SYSTEM',
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    await db.collection(`user_chats/${currentUser.uid}/messages`).add(blessingMessage);
                    await db.collection('users').doc(currentUser.uid).set({
                        lastBlessingTimestamp: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true });
                     await db.collection('user_chats').doc(currentUser.uid).update({
                        lastUpdate: firebase.firestore.FieldValue.serverTimestamp(),
                        isRead: false
                    });
                }, 1500);

                setPlea('');
            };
            
            const handleInfoSubmit = async () => {
                const { f168Account, capital, target } = infoFormData;
                if (!f168Account || !capital || !target) {
                    alert("VUI LÒNG NHẬP ĐẦY ĐỦ THÔNG TIN");
                    return;
                }
                const infoContent = { f168Account, capital, target };
                await db.collection(`user_chats/${currentUser.uid}/messages`).add({
                    type: 'info_submission',
                    content: infoContent,
                    senderId: currentUser.uid,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                await db.collection('users').doc(currentUser.uid).set({ hasSubmittedInfo: true }, { merge: true });
                setShowInfoModal(false);
            };

            const EnergyBar = ({ value }) => {
                const percentage = Math.max(0, Math.min(100, (value / 7) * 100));
                const barColor = percentage > 50 ? 'bg-green-500' : percentage > 20 ? 'bg-yellow-500' : 'bg-red-500';
                const barWidth = `${percentage}%`;
                return (
                    <div className="w-full border border-green-700 p-1">
                        <div className="flex items-center">
                            <div className="text-xs sm:text-sm mr-2">N.LƯỢNG:</div>
                            <div className="flex-1 h-4 bg-gray-800">
                                <div className={`h-full ${barColor}`} style={{width: barWidth}}></div>
                            </div>
                            <div className="text-sm ml-2">{value}</div>
                        </div>
                    </div>
                );
            };

            const username = currentUser.email.split('@')[0];
            const canAsk = dailyQuestionsLeft > 0 || energy >= QUESTION_ENERGY_COST;

            return (
                 <div className={`h-screen p-1 sm:p-2 md:p-4 ${isAnnouncing ? 'yellow-alert-flash' : ''}`}>
                    <div className="w-full h-full flex flex-col retro-container crt-effect">
                        <header className="retro-header flex justify-between items-center">
                            <h2 className="text-lg sm:text-xl glitch-text">AQUARIUS TERMINAL</h2>
                            <button onClick={() => { soundService.playClick(); onLogout(); }} className="text-xs retro-button p-2">NGẮT KẾT NỐI</button>
                        </header>
                        <div className="p-2 border-b border-green-900">
                            <p className="truncate">> PILOT: {username}</p>
                            <EnergyBar value={energy} />
                        </div>
                        <main ref={messagesListRef} className="flex-1 p-2 sm:p-4 overflow-y-auto">
                            {messages.map((msg) => (
                                <div key={msg.id} className="mb-2">
                                    <div className={msg.senderId === currentUser.uid ? 'text-cyan-300' : ''}>
                                        {msg.type === 'system' ? '' : <span className="mr-2">{msg.senderId === currentUser.uid ? `<${username}>` : '<AQUARIUS>'}</span>}
                                        <MessageContent msg={msg} />
                                    </div>
                                </div>
                            ))}
                        </main>
                        <div className="p-2 border-t border-b border-green-900 grid grid-cols-2 gap-2 text-center">
                             <div>
                                <p className="opacity-70 text-sm">HỎI AQUARIUS</p>
                                {dailyQuestionsLeft > 0 ? (
                                    <p className="text-lg">{dailyQuestionsLeft} / {DAILY_QUESTION_LIMIT} LƯỢT MIỄN PHÍ</p>
                                ) : (
                                    <p className="text-lg text-yellow-400">Tốn {QUESTION_ENERGY_COST} N.LƯỢNG</p>
                                )}
                            </div>
                             <div>
                                <p className="opacity-70 text-sm">BAN PHƯỚC</p>
                                {blessingCooldown > 0 ? (
                                    <p className="text-lg text-yellow-400">{formatTime(blessingCooldown)}</p>
                                ) : (
                                     <button onClick={() => {soundService.playClick(); setShowBlessingModal(true);}} className="retro-button text-xs sm:text-sm p-2 mt-1">YÊU CẦU</button>
                                )}
                            </div>
                        </div>
                        <footer className="p-2 border-t border-green-900">
                            <div className="flex w-full items-center">
                                <span className="mr-2 text-lg">></span>
                                <input className="flex-1 retro-input" placeholder="Nhập câu hỏi..." value={inputMessage} onChange={(e) => {setInputMessage(e.target.value); soundService.playTyping();}} onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAskQuestion())} disabled={!canAsk} />
                                <button onClick={handleAskQuestion} disabled={!canAsk} className="ml-2 retro-button p-2">GỬI</button>
                            </div>
                        </footer>
                    </div>
                    {showBlessingModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4">
                            <div className="p-6 retro-container w-full max-w-sm" onClick={e => e.stopPropagation()}>
                                <h3 className="text-xl sm:text-2xl glitch-text mb-4">TRUYỀN TẢI THỈNH CẦU</h3>
                                <textarea value={plea} onChange={e => setPlea(e.target.value)} className="w-full h-24 retro-textarea" placeholder="> Viết lời thỉnh cầu của bạn tại đây..."></textarea>
                                <div className="flex justify-end space-x-4 mt-4">
                                    <button onClick={() => {soundService.playClick(); setShowBlessingModal(false);}} className="retro-button">HỦY</button>
                                    <button onClick={() => {soundService.playClick(); handleBlessingRequest();}} className="retro-button">GỬI</button>
                                </div>
                            </div>
                        </div>
                    )}
                    {showInfoModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4">
                            <div className="p-6 retro-container w-full max-w-sm" onClick={e => e.stopPropagation()}>
                                <h3 className="text-xl sm:text-2xl glitch-text mb-4">YÊU CẦU KHAI BÁO</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-md sm:text-lg">> TÊN TK F168:</label>
                                        <input value={infoFormData.f168Account} onChange={e => setInfoFormData({...infoFormData, f168Account: e.target.value})} type="text" className="w-full mt-1 retro-input" />
                                    </div>
                                    <div>
                                        <label className="text-md sm:text-lg">> SỐ VỐN:</label>
                                        <input value={infoFormData.capital} onChange={e => setInfoFormData({...infoFormData, capital: e.target.value})} type="text" className="w-full mt-1 retro-input" />
                                    </div>
                                     <div>
                                        <label className="text-md sm:text-lg">> MUỐN LÊN BAO NHIÊU:</label>
                                        <input value={infoFormData.target} onChange={e => setInfoFormData({...infoFormData, target: e.target.value})} type="text" className="w-full mt-1 retro-input" />
                                    </div>
                                </div>
                                <div className="flex justify-end mt-6">
                                    <button onClick={() => {soundService.playClick(); handleInfoSubmit();}} className="retro-button">GỬI BÁO CÁO</button>
                                </div>
                            </div>
                        </div>
                    )}
                 </div>
            );
        };
        
        //================================================================================
        // TOP-LEVEL COMPONENT: System
        //================================================================================
        const System = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [isAdmin, setIsAdmin] = useState(false);

            useEffect(() => {
                const startAudio = () => {
                    soundService.init();
                    soundService.startAmbient();
                    document.removeEventListener('click', startAudio);
                    document.removeEventListener('keydown', startAudio);
                };
                document.addEventListener('click', startAudio);
                document.addEventListener('keydown', startAudio);

                const unsubscribeAuth = auth.onAuthStateChanged(user => {
                    setCurrentUser(user);
                    setIsAdmin(user ? user.email.split('@')[0] === ADMIN_USERNAME : false);
                    setIsLoading(false);
                    if (user) {
                        const userStatusRef = rtdb.ref('/status/' + user.uid);
                        const isOnline = { isOnline: true, lastSeen: firebase.database.ServerValue.TIMESTAMP };
                        const isOffline = { isOnline: false, lastSeen: firebase.database.ServerValue.TIMESTAMP };
                        rtdb.ref('.info/connected').on('value', snapshot => {
                            if (snapshot.val() === false) return;
                            userStatusRef.onDisconnect().set(isOffline).then(() => userStatusRef.set(isOnline));
                        });
                    }
                });

                return () => {
                    unsubscribeAuth();
                    document.removeEventListener('click', startAudio);
                    document.removeEventListener('keydown', startAudio);
                };
            }, []);

            const handleLogout = () => {
                if (auth.currentUser) {
                    rtdb.ref('/status/' + auth.currentUser.uid).set({
                        isOnline: false,
                        lastSeen: firebase.database.ServerValue.TIMESTAMP
                    });
                }
                auth.signOut();
            };
            
            return (
                <div>
                    <Starfield />
                    {isLoading ? (
                        <div className="min-h-screen bg-black flex items-center justify-center text-2xl animate-pulse"><p>ĐANG KHỞI ĐỘNG HỆ THỐNG...<span className="typing-cursor"></span></p></div>
                    ) : !currentUser ? (
                        <LoginScreen />
                    ) : isAdmin ? (
                        <AdminDashboard currentUser={currentUser} onLogout={handleLogout} />
                    ) : (
                        <UserView currentUser={currentUser} onLogout={handleLogout} />
                    )}
                </div>
            );
        };

        ReactDOM.render(<System />, document.getElementById('root'));
    </script>
</body>
</html>
